## Grid Searches {#sec-app-grid}

```{julia}
projectdir = splitpath(pwd()) |>
    ss -> joinpath(ss[1:findall([s == "CounterfactualTraining.jl" for s in ss])[1]]...) 
cd(projectdir)

using CTExperiments
using CTExperiments.CSV
using CTExperiments.DataFrames
using CTExperiments.StatsBase

using DotEnv
DotEnv.load!()
```

```{julia}
res_dir = ENV["FINAL_GRID_RESULTS"]
```

### Generator Parameters

The hyperparameter grid with varying generator parameters during training is shown in @exr-gen-params-final-run-train. The corresponding evaluation grid used for these experiments is shown in @exr-gen-params-final-run-eval.

::: {#exr-gen-params-final-run-train}

## Training Phase

```{julia}
#| output: asis
dict = CTExperiments.from_toml(joinpath(res_dir,"gen_params/mlp/lin_sep/grid_config.toml")) 
println(CTExperiments.dict_to_quarto_markdown(dict))
```

:::


::: {#exr-gen-params-final-run-eval}

## Evaluation Phase

```{julia}
#| output: asis
dict = CTExperiments.from_toml(joinpath(res_dir, "gen_params/mlp/lin_sep/evaluation/evaluation_grid_config.toml"))
println(CTExperiments.dict_to_quarto_markdown(dict))
```

:::

### High-Level Findings

![](/paper/experiments/output/final_run/gen_params/mlp/moons/evaluation/results/ce/decision_threshold_exper---lambda_energy_exper---maxiter_exper---maxiter---decision_threshold_exper/plausibility_distance_from_target.png)

![](/paper/experiments/output/final_run/gen_params/mlp/moons/evaluation/results/ce/decision_threshold_exper---lambda_energy_exper---maxiter_exper---maxiter---decision_threshold_exper/distance.png)

![](/paper/experiments/output/final_run/gen_params/mlp/moons/evaluation/results/logs/objective---lambda_energy---generator_type---maxiter/percent_valid.png)

![](/paper/experiments/output/final_run/gen_params/mlp/moons/evaluation/results/logs/objective---lambda_energy---generator_type---maxiter/acc_val.png)

### Detailed Findings

```{julia}
gen_params_dir = joinpath(res_dir, "gen_params/mlp")
```

#### Linearly Separable 

```{julia}
df = CSV.read("$(gen_params_dir)/lin_sep/evaluation/results/ce/decision_threshold_exper---lambda_energy_exper---maxiter_exper---maxiter---decision_threshold_exper/plausibility_distance_from_target.csv", DataFrame)
select!(df, Not(:objective))
df = groupby(df, Not(:run, :mean, :lambda_energy_eval, :is_pct)) |> 
  gdf -> combine(gdf, :mean => (x -> [(mean(x),std(x))]) => [:value,:std]) |>
  df -> sort(df, [:lambda_energy_exper, :decision_threshold_exper, :maxiter_exper, :generator_type])
```

::: {#tbl-lin_sep-lambda_energy_exper}

::: {.content-hidden unless-format="pdf"}

```{julia}
#| output: asis

using CTExperiments.ColorSchemes
get_table_inputs(df, "value"; alpha=0.9, byvars=["lambda_energy_exper", "decision_threshold_exper", "maxiter_exper"], backend=Val(:latex)) |>
    inputs -> tabulate_results(inputs; wrap_table=false)
```

:::

Results for Linearly Separable data by energy penalty.

:::


